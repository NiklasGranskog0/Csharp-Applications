@page "/Delete/{m_Id:guid}"
@using BlazorApp1.Services
@using WebApplication1.Model
@rendermode InteractiveServer
@inject DrinkService m_DrinkService

<PageTitle>Delete Drink</PageTitle>

<h1>Do you want to delete this drink?</h1>

@if (m_Drink is null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="border p-3 mb-3">
        <dl class="row">
            <dt class="col-sm-2">Image</dt>
            <dd class="col-sm-10">
                <img src="@LoadImageSrc(m_Drink)" alt="No Image" style="width: 100px; height: 100px;"/>
            </dd>

            <dt class="col-sm-2">Name</dt>
            <dd class="col-sm-10">@m_Drink.Name</dd>

            <dt class="col-sm-2">Type</dt>
            <dd class="col-sm-10">@m_Drink.Type</dd>

            <dt class="col-sm-2">Category</dt>
            <dd class="col-sm-10">@m_Drink.Category</dd>

            <dt class="col-sm-2">Description</dt>
            <dd class="col-sm-10">@m_Drink.Description</dd>
        </dl>

        <button class="btn btn-danger" type="submit" @onclick="DeleteDrink">Delete</button>
        <button class="btn btn-info" type="submit" @onclick="Cancel">Cancel</button>
    </div>
}

@code {
    private Drink? m_Drink { get; set; }

    [Parameter] public Guid m_Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        m_Drink ??= await m_DrinkService.GetDrinkById(m_Id);
    }

    private void Cancel() => m_DrinkService.ReturnTo("/");

    private async Task DeleteDrink()
    {
        await m_DrinkService.DeleteDrink(m_Id);
        m_DrinkService.ReturnTo("/AvailableDrinks");
    }

    private string LoadImageSrc(Drink? drink)
    {
        if (drink!.ImageUrl is null) return "";

        var imageType = "image/png";

        if (drink.ImageUrl.StartsWith("/9j/"))
            imageType = "image/jpeg";

        return $"data:{imageType};base64,{drink.ImageUrl}";
    }

}